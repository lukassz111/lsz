(function(g,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(g=typeof globalThis<"u"?globalThis:g||self,h(g.Lsz={}))})(this,(function(g){"use strict";const a=class a{constructor(){this.mutationsObserver=null,this.functionsHtmlCodeElement=[{name:"attr",callback:(n,t)=>{let r="";return Array.isArray(t)?t[0]:r=t,n.getAttribute(r)||""}},{name:"isParentOf",callback:(n,t)=>{let r="";return Array.isArray(t)?r=t[0]||"":r=t,[...n.querySelectorAll(r)].filter(e=>e.parentElement===n).length>0}},{name:"isAncestorOf",callback:(n,t)=>{let r="";return Array.isArray(t)?r=t[0]||"":r=t,n.querySelector(r)!==null}}],this.behaviors=[],this.mutationsObserver=new MutationObserver(n=>{n.forEach(t=>{if(t.type==="childList")this.behaviors.forEach(r=>{if(t.addedNodes.forEach(e=>{e instanceof HTMLElement&&(r.triggerOnElementsWithAttribute.some(s=>e.hasAttribute(s))||r.triggerOnElementsWithClass.some(s=>e.classList.contains(s)))&&(a.debugLogForMutationObserver("Triggering behavior for added element:",{behavior:r.name,element:e}),r.ignoreTriggerAttributes.some(s=>e.hasAttribute(s))?a.debugLogForMutationObserver("Ignoring behavior for added element due to ignoreTriggerAttributes:",{behavior:r.name,element:e}):r.callbackForElement(this,e))}),t.target instanceof HTMLElement){const e=t.target;(r.triggerOnElementsWithAttribute.some(s=>e.hasAttribute(s))||r.triggerOnElementsWithClass.some(s=>e.classList.contains(s)))&&(a.debugLogForMutationObserver("Triggering behavior for target element due to childList mutation:",{behavior:r.name,element:e}),r.ignoreTriggerAttributes.some(s=>e.hasAttribute(s))?a.debugLogForMutationObserver("Ignoring behavior for added element due to ignoreTriggerAttributes:",{behavior:r.name,element:e}):r.callbackForElement(this,e))}});else if(t.type==="attributes"||t.type==="characterData"){if(t.attributeName===this.getAttributeNameforlszOnce())return;const r=t.attributeName||"",e=t.target;this.behaviors.forEach(s=>{if(s.ignoreTriggerAttributes.indexOf(r)!==-1){a.debugLogForMutationObserver("Ignoring behavior for element due to ignoreTriggerAttributes:",{behavior:s.name,attributeName:r,element:e});return}s.triggerOnElementsWithAttribute.indexOf(r)!==-1||s.triggerOnElementsWithAttribute.indexOf("*")!==-1?(a.debugLogForMutationObserver("Triggering behavior for element due to attribute mutation:",{behavior:s.name,attributeName:r,element:e}),s.callbackForElement(this,e)):s.triggerOnElementsWithClass.some(o=>e.classList.contains(o))&&(a.debugLogForMutationObserver("Triggering behavior for element due to class mutation:",{behavior:s.name,element:e}),s.callbackForElement(this,e))})}else a.debugLogForMutationObserver("Mutation observed:",{type:t.type})})}),this.mutationsObserver.observe(document.body,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),this.createInitialBehavior(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{this.runBehaviors()}):this.runBehaviors()}static getInstance(){return a.instance===null&&(a.instance=new a),a.instance}static start(){a.getInstance()}static isDebugMode(){return!0}static debugLog(...n){a.isDebugMode()&&console.log("[LSZ DEBUG]:",...n)}static debugLogForBehavior(n,...t){["html-content","conditional-class"].indexOf(n)===-1&&a.isDebugMode()&&console.log(`[LSZ DEBUG][Behavior: ${n}]:`,...t)}static debugLogForMutationObserver(...n){}htmlElementAddClassIfNotExists(n,t){n.classList.contains(t)||n.classList.add(t)}htmlElementRemoveClassIfExists(n,t){n.classList.contains(t)&&n.classList.remove(t)}prepareClassName(n){return"lsz-"+n}prepareAttributeName(n){return"data-lsz-"+n}getAttributeNameforlszOnce(){return this.prepareAttributeName("once")}lszOnce(n,t){const r=this.getAttributeNameforlszOnce();return n.filter(function(e){if(e.hasAttribute(r)){let o=(e.getAttribute(r)||"").split(" ");return o.indexOf(t)!==-1?!1:(o.push(t),e.setAttribute(r,o.join(" ")),!0)}else return e.setAttribute(r,t),!0}),n}lszOnceSelector(n,t){return this.lszOnce([...document.querySelectorAll(n)],t)}lszOnceClass(n,t){const r="."+n;return this.lszOnceSelector(r,t)}lszOnceAttribute(n,t){const r="["+n+"]";return this.lszOnceSelector(r,t)}selectElementsWithClass(n,t){return n.filter(r=>r.classList.contains(t))}selectElementsWithAttribute(n,t){return n.filter(r=>r.hasAttribute(t))}mapFunctionsWithElementToBasic(n,t){return t.map(r=>({name:r.name,callback:(...e)=>r.callback(n,...e)}))}evaluateExpression(n,t){let r=n;for(const e of t){const s=new RegExp(e.name+"\\((.*?)\\)","g");let o,i=0;for(;(o=s.exec(r))!==null;){const l=o[0],c=o[1],u=e.callback(c).toString().replace(/{/g,"&lcub;").replace(/}/g,"&rcub;");if(r=r.replace(l,u),i++,i>1e3){console.warn("Potential infinite loop detected in evaluateExpression for function:",e.name);break}}}return r}evaluateHtmlCodeElement(n,t){const r=this.mapFunctionsWithElementToBasic(n,this.functionsHtmlCodeElement);let e=t.match(/{{(.*?)}}/g);for(const s of e||[]){const o=s.slice(2,-2).trim(),i=this.evaluateExpression(o,r);t=t.replace(s,i)}return t}evaluateConditionCodeElement(n,t){const r=this.mapFunctionsWithElementToBasic(n,this.functionsHtmlCodeElement),e=new Map;return r.forEach(o=>{const i=new RegExp(o.name+"\\((.*?)\\)");let l=null;do if(l=i.exec(t),l!=null){const c=l[0],u=l[1],m=o.callback(u)?"true()":"false()";t=t.replace(c,m)}while(l!=null)}),e.set(/not\s{1,}true\(\)/,"false()"),e.set(/not\s{1,}false\(\)/,"true()"),e.set(/true\(\)\s{1,}or\s{1,}true\(\)/,"true()"),e.set(/true\(\)\s{1,}or\s{1,}false\(\)/,"true()"),e.set(/false\(\)\s{1,}or\s{1,}true\(\)/,"true()"),e.set(/false\(\)\s{1,}or\s{1,}false\(\)/,"false()"),e.set(/true\(\)\s{1,}and\s{1,}true\(\)/,"true()"),e.set(/true\(\)\s{1,}and\s{1,}false\(\)/,"false()"),e.set(/false\(\)\s{1,}and\s{1,}true\(\)/,"false()"),e.set(/false\(\)\s{1,}and\s{1,}false\(\)/,"false()"),e.set(/\(\s{1,}false\(\)\s{1,}\)/,"false()"),e.set(/\(\s{1,}true\(\)\s{1,}\)/,"true()"),t=(o=>{let i=o,l=o;do i=l,e.forEach((c,u)=>{l=l.replace(u,c)});while(i!==l);return l})(t),t.trim()==="true()"}createInitialBehavior(){(()=>{const n=this.prepareClassName("css-scroll"),t=this.prepareClassName("scroll-at-top"),r=this.prepareClassName("scrolled"),e=o=>{let i=null,l=0;o instanceof HTMLElement?(i=o,l=i.scrollTop):(i=document.querySelector("body"),l=window.scrollY||document.documentElement.scrollTop);const c=window.getComputedStyle(i),u=parseFloat(c.scrollPaddingTop)||0;l<=u*1.1?(this.htmlElementAddClassIfNotExists(i,t),this.htmlElementRemoveClassIfExists(i,r)):(this.htmlElementAddClassIfNotExists(i,r),this.htmlElementRemoveClassIfExists(i,t))},s=o=>{const i=o.currentTarget;e(i)};this.behaviors.push({name:"css-scroll",description:"When an element with class dispatches event scroll on itself.",callbackForPage:o=>{o.lszOnceClass(n,"css-scroll-initialized").forEach(i=>{i.tagName.toUpperCase()==="BODY"?(window.addEventListener("scroll",s),e(window)):(i.addEventListener("scroll",s),e(i))})},callbackForElement:(o,i)=>{o.lszOnce(o.selectElementsWithClass([i],n),"css-scroll-initialized").forEach(l=>{i.tagName.toUpperCase()==="BODY"?(window.addEventListener("scroll",s),e(window)):(i.addEventListener("scroll",s),e(i))})},triggerOnElementsWithClass:[n],triggerOnElementsWithAttribute:[],ignoreTriggerAttributes:[],triggerOnWindowResize:!1})})(),(()=>{const n=this.prepareAttributeName("html-content"),t=this.prepareAttributeName("html-content-locked"),r=(e,s)=>{if(s.hasAttribute(t)){a.debugLogForBehavior("html-content","Element is locked, skipping processing for element:",s);return}s.setAttribute(t,"1"),a.debugLogForBehavior("html-content","Processing html-content for element:",s);const o=s.getAttribute(n)||"",i=e.evaluateHtmlCodeElement(s,o);s.innerHTML!==i&&(s.innerHTML=i,a.debugLogForBehavior("html-content","Updated innerHTML for element:",s)),setTimeout(()=>{s.removeAttribute(t)},100)};this.behaviors.push({name:"html-content",description:"Set innerHTML of element with attribute value 'data-lsz-html-content' to the attribute's value.",callbackForPage:e=>{document.querySelectorAll("["+n+"]").forEach(s=>{r(e,s)})},callbackForElement:(e,s)=>{e.selectElementsWithAttribute([s],n).forEach(o=>{r(e,o)})},triggerOnElementsWithClass:[],triggerOnElementsWithAttribute:[n,"*"],ignoreTriggerAttributes:[t],triggerOnWindowResize:!1})})(),(()=>{const n=this.prepareAttributeName("conditional-class"),t=(r,e)=>{const s=e.getAttribute(n)||"";JSON.parse(s).forEach(i=>{const l=i.class,c=i.condition;a.debugLogForBehavior("conditional-class","Processing conditional-class for element:",e,"with condition:",i),this.evaluateConditionCodeElement(e,c)?(r.htmlElementAddClassIfNotExists(e,l),a.debugLogForBehavior("conditional-class",`Added class '${l}' to element:`,e)):(r.htmlElementRemoveClassIfExists(e,l),a.debugLogForBehavior("conditional-class",`Removed class '${l}' from element:`,e))})};this.behaviors.push({name:"conditional-class",description:"Add or remove classes based on conditions defined in 'data-lsz-conditional-class' attribute.",callbackForPage:r=>{Array.from(document.querySelectorAll("["+n+"]")),document.querySelectorAll("["+n+"]").forEach(e=>{t(r,e)})},callbackForElement:(r,e)=>{r.selectElementsWithAttribute([e],n).forEach(s=>{t(r,s)})},triggerOnElementsWithClass:[],triggerOnElementsWithAttribute:[n,"*"],ignoreTriggerAttributes:[],triggerOnWindowResize:!1})})(),(()=>{const n=this.prepareAttributeName("fetch-html-content"),t=this.prepareAttributeName("fetch-html-content-locked"),r=(e,s)=>{let o=s.getAttribute(n)||"";if(s.hasAttribute(t)&&o.trim()==(s.getAttribute(t)||"").trim()){a.debugLogForBehavior("fetch-html-content","Element is locked, skipping processing for element:",s);return}if(s.setAttribute(t,o),o.trim()===""){a.debugLogForBehavior("fetch-html-content","Attribute value is empty, skipping processing for element:",s);return}let i=new URL(o,window.location.href);fetch(i.toString(),{method:"GET",headers:{"Content-Type":"text/html"}}).then(l=>{if(!l.ok)a.debugLogForBehavior("fetch-html-content","Fetch error, response not ok for URL:",i.toString(),"Status:",l.status),s.removeAttribute(t);else return l.text()}).then(l=>{s.innerHTML!==l&&typeof l=="string"&&(s.innerHTML=l,a.debugLogForBehavior("fetch-html-content","Updated innerHTML for element:",s))}).catch(l=>{console.error("Fetch error for URL:",i.toString(),l),s.removeAttribute(t)}),a.debugLogForBehavior("fetch-html-content","Processing fetch-html-content for element:",s,"with URL:",i.toString())};this.behaviors.push({name:"fetch-html-content",description:"Set innerHTML of element with attribute value 'data-lsz-fetch-html-content' to the attribute's value.",callbackForPage:e=>{document.querySelectorAll("["+n+"]").forEach(s=>{r(e,s)})},callbackForElement:(e,s)=>{e.selectElementsWithAttribute([s],n).forEach(o=>{r(e,o)})},triggerOnElementsWithClass:[],triggerOnElementsWithAttribute:[n,"*"],ignoreTriggerAttributes:[t],triggerOnWindowResize:!1})})()}runBehaviors(){this.behaviors.forEach(n=>{n.callbackForPage(this)})}};a.instance=null;let h=a;g.Lsz=h,Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})}));
